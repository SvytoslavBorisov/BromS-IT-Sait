<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BromSIT Mini App</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    html,body { margin:0; padding:0; font-family: system-ui, sans-serif; }
    .wrap { min-height: 100dvh; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:16px; }
    .card { padding:20px; border-radius:16px; box-shadow: 0 8px 24px rgba(0,0,0,.07); background: var(--bg, #fff); width:min(480px, 90vw); }
    .row { display:flex; gap:8px; align-items:center; justify-content:space-between; }
    button { padding:12px 16px; border:0; border-radius:12px; cursor:pointer; font-size:16px; }
    .btn { background:#0ea5e9; color:#fff; }
    .muted { opacity:.75; font-size:14px; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h2>üéÆ BromSIT Mini App</h2>
      <p>–≠—Ç–æ –ø—Ä–æ—Å—Ç–µ–π—à–∏–π –ø—Ä–∏–º–µ—Ä –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤–Ω—É—Ç—Ä–∏ Telegram WebView.</p>

      <div class="row">
        <span>–û—á–∫–∏:</span>
        <strong id="score">0</strong>
      </div>

      <div class="row" style="margin-top:12px;">
        <button id="plus" class="btn">+1 –æ—á–∫–æ</button>
        <button id="save" class="btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      </div>

      <p class="muted" style="margin-top:12px;">–û—Ç–∫—Ä–æ–µ—Ç—Å—è —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É –≤ –±–æ—Ç–µ: <code>/play</code></p>
    </div>
  </div>

  <script>
    const tg = window.Telegram.WebApp;
    tg.expand();                 // —Å–¥–µ–ª–∞—Ç—å WebView –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º
    tg.ready();
    // –¢–µ–º–∞
    document.documentElement.style.setProperty('--bg', tg.themeParams.bg_color || '#fff');

    let score = 0;
    const elScore = document.getElementById('score');
    const elPlus  = document.getElementById('plus');
    const elSave  = document.getElementById('save');

    elPlus.addEventListener('click', () => {
      score++;
      elScore.textContent = String(score);
      tg.HapticFeedback.impactOccurred('light');
    });

    // –ü–æ–∫–∞–∑–∞—Ç—å –≥–ª–∞–≤–Ω—É—é –∫–Ω–æ–ø–∫—É Telegram (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ)
    tg.MainButton.setText('üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—á–∫–∏');
    tg.MainButton.onClick(saveScore);
    tg.MainButton.show();

    elSave.addEventListener('click', saveScore);

    async function saveScore() {
      try {
        // –ú–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ–±—Ä–∞—Ç–Ω–æ –≤ –±–æ—Ç —á–µ—Ä–µ–∑ sendData (–±–æ—Ç –ø–æ–π–º–∞–µ—Ç web_app_data)
        // tg.sendData(JSON.stringify({ score }));

        // –ò–ª–∏ –ø–æ—Å—Ç–æ–º –Ω–∞ —Å–≤–æ–π API (—É–¥–æ–±–Ω–æ –¥–ª—è —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è)
        const resp = await fetch('/api/progress', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            score,
            // initData –º–æ–∂–Ω–æ –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –±—ç–∫–µ–Ω–¥–µ (—Å–º. TODO –≤ index.js)
            initData: tg.initData || ''
          })
        });
        const json = await resp.json();
        tg.showPopup({ title: '–ì–æ—Ç–æ–≤–æ', message: '–û—á–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã ‚úÖ' });
      } catch (e) {
        tg.showPopup({ title: '–û—à–∏–±–∫–∞', message: String(e) });
      }
    }
  </script>
</body>
</html>
