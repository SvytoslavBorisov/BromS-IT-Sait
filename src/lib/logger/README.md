# üìö Logger ‚Äî —Å–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞

## 1. –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
–õ–æ–≥–≥–µ—Ä –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ, —É–¥–æ–±–Ω–æ–≥–æ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –≤–µ–¥–µ–Ω–∏—è –ª–æ–≥–æ–≤ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏.  

–û–Ω:
- –†–∞–±–æ—Ç–∞–µ—Ç –≤ **Node.js-—Å—Ä–µ–¥–µ**, –∞ —Ç–∞–∫–∂–µ –≤ Next.js (client, build, edge):
  - –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –∏ –≤ build-—Ñ–∞–∑–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è no-op –ª–æ–≥–≥–µ—Ä (–Ω–µ –¥–µ–ª–∞–µ—Ç –Ω–∏—á–µ–≥–æ, —á—Ç–æ–±—ã –Ω–µ –ª–æ–º–∞—Ç—å —Å–±–æ—Ä–∫—É);
  - –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å.
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç:
  - —É—Ä–æ–≤–Ω–∏ `debug`, `info`, `warn`, `error`;
  - –∑–∞–ø–∏—Å—å –≤ —Ñ–∞–π–ª—ã —Å —Ä–æ—Ç–∞—Ü–∏–µ–π –ø–æ –¥–∞—Ç–µ –∏ —Ä–∞–∑–º–µ—Ä—É;
  - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –≤—ã–≤–æ–¥ –≤ `stdout` (–¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –∏ –æ–±–ª–∞–∫–∞);
  - –º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (`token`, `password`, `cookie` –∏ –ø—Ä.);
  - –±–µ–∑–æ–ø–∞—Å–Ω—É—é —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—é –æ–±—ä–µ–∫—Ç–æ–≤ (BigInt, Error, —Ü–∏–∫–ª—ã, –¥–ª–∏–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏);
- –ü–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å **–¥–æ—á–µ—Ä–Ω–∏–µ –ª–æ–≥–≥–µ—Ä—ã** —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º (`service`, `module`, `requestId`).

---

## 2. –ë—ã—Å—Ç—Ä–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ò–º–ø–æ—Ä—Ç
```ts
import { logger, ensureRequestId } from "@/lib/logger";
–ë–∞–∑–æ–≤—ã–µ —É—Ä–æ–≤–Ω–∏
ts
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
logger.debug({ message: "Debug info", data: { x: 42 } });
logger.info({ message: "User logged in", userId: 123 });
logger.warn({ message: "Slow query", durationMs: 2500 });
logger.error({ message: "DB connection failed" });
–õ–æ–≥ –æ—à–∏–±–æ–∫
ts
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
try {
  throw new Error("Something bad happened");
} catch (err) {
  logger.logError(err, { userId: 123 });
}
–î–æ—á–µ—Ä–Ω–∏–µ –ª–æ–≥–≥–µ—Ä—ã
ts
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
const reqLogger = logger.child({ 
  requestId: ensureRequestId(), 
  module: "Auth" 
});

reqLogger.info({ message: "Start processing request" });
reqLogger.error({ message: "Validation failed", fields: ["email"] });
üëâ –ö–æ–Ω—Ç–µ–∫—Å—Ç (requestId, module) –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –∫–æ –≤—Å–µ–º –∑–∞–ø–∏—Å—è–º.

–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
ts
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
import { shutdownLogger } from "@/lib/logger";

process.on("SIGTERM", async () => {
  await shutdownLogger();
  process.exit(0);
});
3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è	–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é	–û–ø–∏—Å–∞–Ω–∏–µ
LOG_DIR	./logs	–ü–∞–ø–∫–∞ –¥–ª—è –ª–æ–≥–æ–≤
LOG_FILE	app	–ë–∞–∑–æ–≤–æ–µ –∏–º—è —Ñ–∞–π–ª–∞ (app-2025-10-01.log)
LOG_LEVEL	info	–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å (debug, info, warn, error)
LOG_ROTATE_DAILY	true	–†–æ—Ç–∞—Ü–∏—è –ø–æ –¥–∞—Ç–µ (–Ω–æ–≤—ã–π —Ñ–∞–π–ª —Ä–∞–∑ –≤ –¥–µ–Ω—å)
LOG_MAX_BYTES	10 * 1024 * 1024	–ú–∞–∫—Å. —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10 –ú–ë)
LOG_STDOUT	false	–ï—Å–ª–∏ true ‚Äî –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å JSON-—Å—Ç—Ä–æ–∫—É –≤ stdout
LOG_TRUNCATE_LIMIT	20000	–ú–∞–∫—Å. –¥–ª–∏–Ω–∞ —Å—Ç—Ä–æ–∫–∏ –≤ JSON (–æ–±—Ä–µ–∑–∫–∞, –µ—Å–ª–∏ –±–æ–ª—å—à–µ)

4. –ú–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–º–µ–Ω—è–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ–ª–µ–π —Å —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º–∏ –∫–ª—é—á–∞–º–∏ –Ω–∞ ***.

–ö–ª—é—á–∏ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –±–µ–∑ —É—á—ë—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞:

pgsql
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
password, pass, pwd, token, accessToken, refreshToken, secret, apiKey,
authorization, cookie, set-cookie, session, jwt, bearer, x-api-key, csrf
–ü—Ä–∏–º–µ—Ä:

ts
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
logger.info({
  message: "User login",
  data: { email: "test@mail.ru", password: "123456" }
});
// => password –±—É–¥–µ—Ç –∑–∞–º–µ–Ω—ë–Ω –Ω–∞ ***
5. –û—Ç–ª–∏—á–∏—è –æ—Ç console.log
console.log ‚Äî –ø—Ä–æ—Å—Ç–æ –ø–µ—á–∞—Ç–∞–µ—Ç –≤ stdout.

logger:

–ø–∏—à–µ—Ç –≤ —Ñ–∞–π–ª (—Å —Ä–æ—Ç–∞—Ü–∏–µ–π),

–¥—É–±–ª–∏—Ä—É–µ—Ç –≤ stdout (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ),

–º–∞—Å–∫–∏—Ä—É–µ—Ç —Å–µ–∫—Ä–µ—Ç—ã,

–¥–æ–±–∞–≤–ª—è–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç (requestId, module),

–±–µ–∑–æ–ø–∞—Å–Ω–æ —Å–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç —Å–ª–æ–∂–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã.

6. –ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –¥–ª—è –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–æ–≤ (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ)
–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
–ö–æ–¥ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ src/lib/logger/ –∏ —Ä–∞–∑–¥–µ–ª—ë–Ω –Ω–∞ –º–æ–¥—É–ª–∏:

types.ts ‚Äî –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∏ —Ç–∏–ø—ã –ª–æ–≥–≥–µ—Ä–∞.

env.ts ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è.

runtime.ts ‚Äî –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ä–µ–¥—ã (client/build/edge/server).

utils.ts ‚Äî —É—Ç–∏–ª–∏—Ç—ã: —Ü–≤–µ—Ç–Ω–æ–π –≤—ã–≤–æ–¥, –º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ, safe stringify.

noopLogger.ts ‚Äî no-op —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (–∫–ª–∏–µ–Ω—Ç, –±–∏–ª–¥, edge).

core.ts ‚Äî –µ–¥–∏–Ω—ã–π writer: –ø–æ—Ç–æ–∫, —Å—á—ë—Ç—á–∏–∫–∏, —Ä–æ—Ç–∞—Ü–∏—è.

serverLogger.ts ‚Äî –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –ª–æ–≥–≥–µ—Ä, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π core.

index.ts ‚Äî —Ñ–∞—Å–∞–¥, —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç logger, getLogger, ensureRequestId, shutdownLogger.

–õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã
–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ä–µ–¥—ã

–í client, build, edge –ª–æ–≥–≥–µ—Ä –∑–∞–º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ noopLogger.

–í Node.js-—Å—Ä–µ–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è ServerLogger.

–û–¥–∏–Ω –ø–æ—Ç–æ–∫ –¥–ª—è –≤—Å–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–í core.ts —Ö—Ä–∞–Ω–∏—Ç—Å—è –≥–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç core —Å–æ —Å—Å—ã–ª–∫–æ–π –Ω–∞ –ø–æ—Ç–æ–∫, —Å—á—ë—Ç—á–∏–∫–æ–º –±–∞–π—Ç–æ–≤ –∏ —Ç–µ–∫—É—â–∏–º –¥–Ω—ë–º.

–í—Å–µ logger.child() –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –ø–æ—Ç–æ–∫.

–†–æ—Ç–∞—Ü–∏—è

–ü–æ –¥–∞—Ç–µ (LOG_ROTATE_DAILY).

–ü–æ —Ä–∞–∑–º–µ—Ä—É (LOG_MAX_BYTES).

–ê–ª–≥–æ—Ä–∏—Ç–º:

–ó–∞–∫—Ä—ã—Ç—å —Ç–µ–∫—É—â–∏–π –ø–æ—Ç–æ–∫.

–ï—Å–ª–∏ —Ä–æ—Ç–∞—Ü–∏—è –ø–æ —Ä–∞–∑–º–µ—Ä—É ‚Üí –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–π —Ñ–∞–π–ª —Å –¥–∞—Ç–æ–π –∏ –≤—Ä–µ–º–µ–Ω–µ–º.

–û—Ç–∫—Ä—ã—Ç—å –Ω–æ–≤—ã–π –ø–æ—Ç–æ–∫.

–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è

safeStringify –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç:

BigInt ‚Üí —Å—Ç—Ä–æ–∫–∞,

Error ‚Üí { name, message, stack, code, errno, syscall, cause },

—Ü–∏–∫–ª—ã ‚Üí [Circular],

–¥–ª–∏–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ ‚Üí –æ–±—Ä–µ–∑–∞—é—Ç—Å—è (LOG_TRUNCATE_LIMIT).

–ú–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ

maskSensitive —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ –ø—Ä–æ—Ö–æ–¥–∏—Ç –æ–±—ä–µ–∫—Ç –¥–æ –≥–ª—É–±–∏–Ω—ã 5.

–õ—é–±–æ–π –∫–ª—é—á –∏–∑ SENSITIVE_KEYS ‚Üí ***.

–î–æ—á–µ—Ä–Ω–∏–µ –ª–æ–≥–≥–µ—Ä—ã

logger.child({ module: "Auth" }) —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–π –æ–±—ä–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π –¥–æ–±–∞–≤–ª—è–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –∫ –∫–∞–∂–¥–æ–π –∑–∞–ø–∏—Å–∏.

–ü–æ—Ç–æ–∫ –æ–±—â–∏–π, –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ—Ç.

Dev-—Ä–µ–∂–∏–º

–ï—Å–ª–∏ NODE_ENV !== production:

–≤—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª—å —Å —Ü–≤–µ—Ç–∞–º–∏ (debug=—Å–µ—Ä—ã–π, info=–≥–æ–ª—É–±–æ–π, warn=–∂—ë–ª—Ç—ã–π, error=–∫—Ä–∞—Å–Ω—ã–π);

—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ util.inspect –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞.

Backpressure (–ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ –±—É—Ñ–µ—Ä–∞)

–ï—Å–ª–∏ stream.write() –≤–µ—Ä–Ω—É–ª false, –≤—ã–≤–æ–¥–∏—Ç—Å—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ "write buffer is full", –ª–æ–≥–≥–µ—Ä –∂–¥—ë—Ç drain.

7. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
–§–æ—Ä–º–∞—Ç: Markdown (.md) ‚Äî –ª—É—á—à–∏–π –≤–∞—Ä–∏–∞–Ω—Ç –¥–ª—è IDE, GitHub/GitLab, Confluence.

–ì–¥–µ —Ö—Ä–∞–Ω–∏—Ç—å:

–ï—Å–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∫–∞—Å–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ª–æ–≥–≥–µ—Ä–∞ ‚Üí src/lib/logger/README.md.

–ï—Å–ª–∏ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –±–æ–ª—å—à–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫ ‚Üí –ª—É—á—à–µ –∑–∞–≤–µ—Å—Ç–∏ –∫–∞—Ç–∞–ª–æ–≥ docs/ –≤ –∫–æ—Ä–Ω–µ –∏ —Ö—Ä–∞–Ω–∏—Ç—å —Ç–∞–º (docs/logger.md), –∞ –≤ src/lib/logger/README.md –æ—Å—Ç–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É.

8. –ü—Ä–∏–º–µ—Ä—ã —Ä–µ–∞–ª—å–Ω–æ–π –ø—Ä–∞–∫—Ç–∏–∫–∏
HTTP-–∑–∞–ø—Ä–æ—Å—ã:

ts
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
const reqLogger = logger.child({ module: "API", requestId: ensureRequestId() });
reqLogger.info({ message: "Incoming request", url: req.url, method: req.method });
–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞:

ts
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
logger.info({ message: "Payment succeeded", userId, amount });
logger.warn({ message: "Payment retry needed", userId, attempt });
logger.error({ message: "Payment failed", userId, error });
–§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏:

ts
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
const jobLogger = logger.child({ module: "Cron" });
jobLogger.info({ message: "Started cleanup job" });